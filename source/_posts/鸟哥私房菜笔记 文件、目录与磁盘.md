---
title: 鸟哥私房菜笔记 文件、目录与磁盘
date: 2018-02-09 19:50:38
categories: Linux
tags:
    - 笔记
    - Linux
---

## 基本命令

显示日期命令 **date**

    > date 显示当前日期
    > date +%Y/%m/%d 格式化显示日期

显示日历命令 **cal**

    > cal 显示当前月份的日历
    > cal 2018 显示指定年份的日历，全年12个月都会显示
    > cal [options] [[[day] month] year]

计算器 **bc**
> bc 进入计算器模式

退出命令 **Ctrl+D**

文本编辑 **nano**,打开文件后底部都有提示操作信息

 <!-- more --> 

# 文件

## 文件权限

Linux下的文件都是有权限控制，每个文件都有所属的用户和群组，非这个文件的所属用户或者群组是否不可以访问该文件。通过命令 **> ls -al** 可以列出文件的详细信息。

    [baiyuas@localhost file]$ ls -al
    权限      | 连接数 |拥有者 | 群组   | 文件容量|日期 |档名    
    drwxrwxr-x. 2 baiyuas baiyuas     64 Feb  7 22:44 .
    drwx------. 3 baiyuas baiyuas     97 Feb  7 23:14 ..
    -rw-rw-r--. 1 baiyuas baiyuas   4096 Feb  7 19:59 by.db
    -rw-r--r--. 1 baiyuas baiyuas  40960 Feb  7 22:44 hb.db
    -rw-rw-r--. 1 baiyuas baiyuas  14672 Feb  7 23:34 hb.sql
    -rw-r--r--. 1 baiyuas baiyuas 118784 Feb  7 01:54 test_hb.db
这里说下权限 **- rwx --- ---** 

- 第一个代表文件类型
> 【d】 表示是目录
> 【-】 表示文件
> 【l】 表示连接

- 之后的每三个一组，分表代表，文件拥有者的权限，同组的权限，其他的权限
> 【r】 读取文件权限
  【w】 修改文件的权限
  【x】 可执行权限

举个栗子：有三个用户a, b, c，用户a和用户b是同组groupab中的用户，现在a用户登录查看文件详情 看到如下：
> -rw-rw-r--. 1 a groupab  14672 Feb  7 23:34 hb.sql

这个时候，a对该文件有读写权限，b因为和a在同一个组所以也可以读写该文件。但是c用户只有读的权限，不可以修改该文件。如果权限是 **-rw-r--r--**则b用户也不可以修改，只能读取该文件

## 权限的修改

介绍来文件的权限后，我们会问如何修改权限呢？这里介绍三个命令

    chgrp ：改变文件所属群组
    chown ：改变文件拥有者
    chmod ：改变文件的权限, SUID, SGID, SBIT等等的特性

- *chgrp [-R] groupname file/dir..*
该命令修改文件或者文件夹所属组，-R代表递归操作，会将要修改的目录以及其子孙目录一起修改所属的组

- *chown [-R] owner[:groupname] file/dir...*
该命令是修改文件所有者[以及用户组]，例如 
> chown -R baiyuas hb.db

hb.db 的用户将会更换为baiyuas用户

- *chmod [-R] xyz file/dir...* 
该命令是修改文件权限，这里讲个小点，`rwx` 分别用数字 `4，2，1`对应。举个栗子如果权限是这个样子`-rw-rw----`也就是用户和用户组有读写权限，现在想让用户组只能有读取权限，就需要使用命令
> chmod 640 filename

就可以修改权限啦。如果你嫌这个太麻烦，那可以使用`u,g,o,a`来处理
> chmod u=rw,g=r filename
> chmod a+w filenaem //将所有用户赋予写权限

## 文件权限的补充

对于这个`x`，我一开始的理解是错误的。看到**rwx**，我的理解觉得是可执行文件的执行权限。然，否也。这个`x`不光是文件的可执行权限，同时还包含`cd`命令的权限，也就是说你是否可以切换到该目录下。
举个例子：首先使用`root`用户切换到`/tmp`目录下
> cd /tmp

创建一个目录`test`，然后修改该文件夹权限组与其他用户只有`r`权限
> mkdir test
  chomd -R o=rwx,g=r,o=r
  
这个时候如果切换到`baiyuas`这个用户使用命令`cd test`，则会提示
> bash: cd: test/: Permission denied
 
## 默认权限

顾名思义就是在你创建文件或者文件夹时候初始化的权限，查看默认权限可以使用`umask`

    $ umask
    0022

这里的0022是表示不包含的权限`rwx`对应这`421`，这里`2`就是不包含写权限，默认创建的文件所有者读写执行
权限都有，同组的只有读和执行权限，其他人也只有读取和执行权限

`-S`会显示`rwx`形式

    $ umask -S
    u=rwx,g=rx,o=rx

我们也可以通过`umask`命令来配置默认的权限

    $ umask 002 // 只有其他用户没有写权限

## 隐藏属性

配置文件的隐藏属性需要使用命令`chattr`

    # chattr [+-=][ASacdistu] 文件或目录名称

`+/-`是添加和移除隐藏属性，`a|i`是常用的配置属性

- `a`当配置 a 之后，这个文件将只能添加数据，而不能删除也不能修改数据，只有root 
  才能配置这个属性。

- `i`它可以让一个文件不能被删除、改名、配置连结也无法
  写入或新增数据！对于系统安全性有相当大的助益！只有 root 能配置此属性

而查看文件隐藏属性需要使用命令`lsattr`

    $ lsattr test.txt
    ----i---------e--- 

查看文件基本数据类型可以使用 `file`

    $ file test.txt
    testA.txt: ASCII text

## 文件内容查看

- cat  由第一行开始显示文件内容

    -a 

- tac  从最后一行开始显示，可以看出 tac 是 cat 的倒著写！
- nl   显示的时候，顺道输出行号！
- more 一页一页的显示文件内容
- less 与 more 类似，但是比 more 更好的是，他可以往前翻页！
- head 只看头几行
- tail 只看尾巴几行
- od   以二进位的方式读取文件内容！

## 文件搜索

搜索命令是一个比较常用的命令，我们经常会遇到一些文件忘记存储的位置，或者安装了一些软件不知道
文件位置在哪里，这时候我们就可以使用搜索命令来查找



# 目录

## Linux下的文件目录

我们切换到根目录`/`目录下，执行`ls -al`命令看到如下文件目录：

```
    /bin -> usr/bin 多放置执行文件目录
    /boot 开机使用的文件目录，包含开机所需要的配置文件
    /dev 包含了所有Linux系统中的外部设备
    /etc 系统主要的配置文件目录
    * /etc/init.d/ 所有服务的启动脚本
    /home 家目录
    /lib -> usr/lib 指令所需要的函式库，主要的是/lib/modules
    /lib64 -> usr/lib64 64位系统中的函式库
    /media 挂载的软盘、光盘、DVD等设备
    /mnt 外置设备
    /opt 安装第三方软件的目录,一般会安装在 /usr/local/目录下
    /proc  虚拟文件目录，放置的数据存放在内容中
    /root 超级管理员的家目录 
    /sbin -> usr/sbin root用户指令依赖库 
    /srv service的缩写，网络服务启动后所需要的数据目录，例如网页数据可以存放在/srv/www/目录下
    /sys 功能类似/proc目录
    /tmp 临时目录，重要数据库不可以存放
    /usr
    /var
```

Linux下的文件目录就是一个树形结构，如下图(图片来自[鸟哥私房菜][1])
![此处输入图片的描述][2]

**容混淆的概念**
> /usr  是Unix Software Resources的缩写，不是user的缩写

### 绝对路径和相对路径

这里介绍个知识点，

> **.** 代表当前目录，
  **..** 代表上一级目录。
  **-** 代表前一个工作目录，比如，你当前在`/usr/local/`目录下，然后使用命令`cd /home/baiyuas/`你会切换到`/home/baiyuas/`目录下，如果你想在返回到`/usr/local/`目录下，可以使用`cd -`。
  **~** 代表家目录
  **~userxx** 代表userxx用户的家目录

### 目录相关的命令

 - **cd** 
 切换目录命令
 - **pwd [-P]** 
 显示当前路径，-P显示当前确实的路径而非link的路径
 - **mkdir [-mp]** 
 创建目录 -m 创建目录时候增加权限`mkdir -m 777 abc`。
 -p 递归创建目录，可以创建多层目录`mkdir -p abc/ccc/a`
 - **rmdir -[p]** 
 删除空目录
 - **echo $PATH**
 查看当前环境变量信息
 
### 文件目录相关的命令

 - **cp [-aipr]**
 -a 文件所有信息都复制过去
 -i 如果文档存在提示是否覆盖
 -p 连同文档树形一起复制过去
 -r 复制目录使用

对于这个命令，我之前一直有个问题，比如有个文件夹`/home/baiyuas/ccc/`，我想把文件夹下所有复制到`/tmp/ccc/`下，但是`/tmp/`目录下没有`ccc`,学习后发现so easy.

> cp -r /home/baiyuas/ccc/ /tmp/ccc
 - **rm [-r]**
 -r 递归删除，有个特别情况，比如有个文件名称为`-aaa-`，这时候删除该文件就在文件前添加当前目录符号，使用命令`rm ./-aaa-`
 - **mv [-fiu]**
 -f 如果目标文件存在则覆盖
 -i 如果目标文件存在，提示是否覆盖
 -u 若目标文件存在，且比source比较新，才会升级
 - **rename**

修改文件名命令，可以批量修改

> `?` 可替代单个字符
  `*` 可替代多个字符
  `[charset]`  可替代charset集中的任意单个字符
 
例如：在/home/baiyuas/file/目录下有文件file1,file2..file10
`rename file newfile newfile0?`命令会把file1, file2...file10重命名为newfile1,newfile2...newfile10,然后在重命名为newfile01,newfile02...newfile010


# 磁盘目录

## 查看磁盘与目录容量

* **df**

`df`列出整个系统的磁盘使用情况

选项与参数：

> -a  ：列出所有的文件系统，包括系统特有的 /proc 等文件系统；
-k  ：以 KBytes 的容量显示各文件系统；
-m  ：以 MBytes 的容量显示各文件系统；
-h  ：以人们较易阅读的 GBytes, MBytes, KBytes 等格式自行显示；
-H  ：以 M=1000K 取代 M=1024K 的进位方式；
-T  ：连同该 partition 的 filesystem 名称 (例如 ext3) 也列出；
-i  ：不用硬盘容量，而以 inode 的数量来显示

示例：

  $ df -m

结果

```
文件系统           1K-块     已用      可用 已用% 挂载点
udev             8007596        0   8007596    0% /dev
```

* **du**

`du`列出指定目录的容量信息

选项参数比df差不多，列出不同的

> -s 列出总量，不列出每个目录的容量
-S  ：不包括子目录下的总计，与 -s 有点差别。

## 实体链接和符号链接 **ln**

硬链接，简单的理解就是不同的档名链接磁盘上相同的节点。
需要记住两点

* 不能跨文件系统
* 不能link目录

符号链接就是Window中的快捷方式。符合链接是一个独立的文件和目标源具有不同的权限和所有者

**ln**

选项参数

> -s 符号链接，默认是硬链接
-f 如果存在覆盖

## 磁盘分区

操作磁盘分区使用命令`fdisk`

查看所有分区

  $ sudo fdisk -l

编辑分区

```
$ sudo fdisk /dev/xxx

欢迎使用 fdisk (util-linux 2.31.1)。
更改将停留在内存中，直到您决定将更改写入磁盘。
使用写入命令前请三思。


命令(输入 m 获取帮助)： m

```
这时候我们按着说明操作就可以，使用`q`退出任何修改都不会生效，使用`w`退出则修改会写入磁盘

## 磁盘格式化

磁盘格式化使用命令`mkfs`

> -t 文件系统格式

## 磁盘检查

磁盘检测使用命令`fsck`

> 
-A  ：依据 /etc/fstab 的内容，将需要的装置扫瞄一次。
-a  ：自动修复检查到的有问题的扇区，所以你不用一直按 y 啰！
-y  ：与 -a 类似，但是某些 filesystem 仅支持 -y 这个参数！
-C  ：可以在检验的过程当中，使用一个直方图来显示目前的进度！
EXT2/EXT3 的额外选项功能：(e2fsck 这支命令所提供)
-f  ：强制检查！
-D  ：针对文件系统下的目录进行优化配置。

## 磁盘挂载与移除

挂载使用命令`mount`

> -t 文件系统
-L Label名
-o 额外选项 比方说账号、密码、读写权限等：
ro, rw:       挂载文件系统成为只读(ro) 或可擦写(rw)
async, sync:  此文件系统是否使用同步写入 (sync) 或异步 (async) 的内存机制，请参考文件系统运行方式。默认为 async。
auto, noauto: 允许此 partition 被以 mount -a 自动挂载(auto)
dev, nodev:   是否允许此 partition 上，可创建装置文件？ dev 为可允许
suid, nosuid: 是否允许此 partition 含有 suid/sgid 的文件格式？
exec, noexec: 是否允许此 partition 上拥有可运行 binary 文件？
user, nouser: 是否允许此 partition 让任何使用者运行 mount ？一般来说，mount 仅有 root 可以进行，但下达 user 参数，则可让一般 user 也能够对此 partition 进行 mount 。
defaults:     默认值为：rw, suid, dev, exec, auto, nouser, and async
remount:      重新挂载，这在系统出错，或重新升级参数时，很有用！

移除使用命令`unmount`

>-f ：强制卸除！可用在类似网络文件系统 (NFS) 无法读取到的情况下；
-n ：不升级 /etc/mtab 情况下卸除。

# 压缩与解压


在Linux环境中，主流的压缩文件包括如下集中

```
 \*.gz  gzip 程序压缩的文件 
 \*.bz2 bzip2 程序压缩的文件
 \*.tar tar程序打包，无压缩
 \*.tar.gz tar打包后，在通过gzip压缩
 \*.tar.bz2 tar打包后，在通过bzip2压缩
```

所以压缩命令主要就是`gzip`、`bzip2`.

- **gzip**

选项参数

> -d 解压
-v 可以显示出原文件/压缩文件的压缩比等资讯；
-# 1-9压缩等级 

示例

  $ gzip -v 档名 // 压缩
  $ gzip -dv 档名.gz // 解压缩
  $ zcat 档名.gz // 查看压缩文件内容

- **bzip2**

选项参数

> -d 解压
-v 可以显示出原文件/压缩文件的压缩比等资讯；
-# 1-9压缩等级 
-k 保留原始文件

示例:
  
  $ bzip2 -kv 档名 // 压缩
  $ bzip2 -dv 档名.gz // 解压缩
  $ bzcat 档名.gz // 查看压缩文件内容

- **tar**

选项参数

> -c 打包
- t 查看打包文件中的档案
- x 解打包配合-j、-z解压缩
- v 显示压缩和解压过程
- f 指定文件
- C 解压到指定目录
- p 保留档案的权限和属性
--exclude=file 打包出列file的所有档案

示例

  $ tar -jcv -f a.tar.bz2 a.txt  // 压缩打包a.txt
  $ tar -jtv -f a.tar.bz2 // 查看压缩包中的文件
  $ tar -jcv -f dir.tar.bz2 needzipdir/ // 压缩打包目录
  $ tar -jxv -f a.tar.bz2 -C needzipdir/ // 将压缩文件解压到指定目录
  $ tar -jxf a.tar.bz2 ./a.txt // 解压压缩文件中指定文件

- **dump**

系统备份命令

[1]: http://cn.linux.vbird.org/linux_basic/0210filepermission_3.php
[2]: http://cn.linux.vbird.org/linux_basic/0210filepermission_files/directory_tree.gif